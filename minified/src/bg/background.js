document.addEventListener("DOMContentLoaded",function(){"granted"!==Notification.permission&&Notification.requestPermission()});var subcribeList,reqCount;chrome.runtime.onMessage.addListener(function(a,b,c){"subcribeToUser"==a.method?chrome.storage.local.get(a.user,function(b){if(!b.ref){var c=new XMLHttpRequest;c.open("GET","http://9gag.com/u/"+a.user+"/posts"),c.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.send(),c.onload=function(){if(200===c.status){var b={};b[a.user]={ref:a.ref,date:Date.now(),avatar:a.avatar,posts:JSON.parse(c.response).ids},chrome.storage.local.set(b)}else console.log("Something went wrong :(.  9GAG Returned status of "+c.status)}}}):c({})});var notify=function(a,b){if(!Notification)return void alert("Desktop notifications not available in your browser. Try Chromium.");if("granted"!==Notification.permission)Notification.requestPermission();else{var c=new Notification("User "+a+" post some new awesomness",{icon:"https://upload.wikimedia.org/wikipedia/commons/thumb/9/97/9GAG_new_logo.svg/340px-9GAG_new_logo.svg.png",body:"Check it out!"});c.onclick=function(){b.forEach(function(a){chrome.tabs.create({active:!0,url:"http://9gag.com/gag/"+a})}),this.close()}}};checkServer=function(){chrome.storage.local.get(null,function(a){for(var b=Object.keys(a),c=b.length-1;c>=0;c--){var d=a[b[c]];d.user=b[c];var e=new XMLHttpRequest;e.open("GET","http://9gag.com/u/"+d.user+"/posts"),e.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.send(),e.item=d,e.onload=function(){if(200===this.status){var a=this.item,b=JSON.parse(this.response).ids,c=b.filter(function(b){return a.posts.indexOf(b)===-1});c.length>0&&notify(a.user,c),a.newPosts?a.newPosts=a.newPosts.concat(c):a.newPosts=c,a.posts=b;var d={};d[a.user]=a,chrome.storage.local.set(d)}else console.log("Something went wrong :(.  9GAG Returned status of "+this.status+" awesomeIndex "+awesomeIndex)}}})},chrome.alarms.create("checkServer",{delayInMinutes:.1,periodInMinutes:5}),chrome.alarms.onAlarm.addListener(function(a){"checkServer"===a.name&&checkServer()});