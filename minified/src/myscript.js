function hasClass(a,b){return a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}function removeClass(a,b){if(hasClass(a,b)){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=a.className.replace(c," ")}}var opId,currOPRef,opIsSetted=!1,currOPdiv,searchDiv,currOP,currHref,opPostToScrollCount=0,subcribeBtn=document.createElement("a");subcribeBtn.className="reply subcribe",subcribeBtn.text="Subcribe";var extensionId=document.getElementById("9gagAwersome").getAttribute("extensionId");!function(){var a=XMLHttpRequest.prototype,b=a.open,c=a.send;a.open=function(a,c){return this._method=a,this._url=c,b.apply(this,arguments)},a.send=function(a){return this.addEventListener("load",function(){if(!opId&&this.responseURL.indexOf("comment-cdn.9gag.com")>0){var a=JSON.parse(this.responseText);if(opId=a.payload.opUserId,!opId){opId="Admin post";var b=document.getElementById("op");if(!b){var c=$(".badge-entry-info.post-afterbar-meta>p");b=document.createElement("a"),c.append(b),b.id="op"}b.text=opId;var c=$(".badge-entry-info.post-afterbar-meta>p");c.append(b)}}}),c.apply(this,arguments)}}();var loadAllComments=function(a){if(!currOPdiv){var b=$(".collapsed-comment>span");b.length>0&&(b.click(),setTimeout(function(){loadAllComments()},200));var c=$(".badge-load-more-trigger>span");c.length>0&&(c.click(),setTimeout(function(){loadAllComments()},200))}},subcribeToUser=function(a){var b=$(a.target),c=$(".username",b.parent().parent()),d=c.text(),e=c.attr("href"),f={method:"subcribeToUser",user:d,ref:e,avatar:$("img",c.parent().parent().parent().parent())[0].src},g=new CustomEvent("subcribeToUser",{detail:f});window.dispatchEvent(g)},scrollToOP=function(){if(currOPdiv){currOP=currOPdiv.text,currOPdiv.scrollIntoView(!0),window.scrollBy(0,-100);var a=document.getElementsByClassName("role-op");a.length>opPostToScrollCount?(currOPdiv=a[opPostToScrollCount].parentElement.parentElement.getElementsByClassName("username")[0],opPostToScrollCount++):(opPostToScrollCount=0,currOPdiv=a[opPostToScrollCount].parentElement.parentElement.getElementsByClassName("username")[0])}else loadAllComments()},findOP=function(){if(currHref?currHref!==window.location.href&&(currHref=window.location.href,currOPdiv=null,opId=null,currOP=null,opIsSetted=!1,$(searchDiv).hasClass("haveOP")&&($(searchDiv).removeClass("haveOP"),searchDiv.className+=" noOP",searchDiv.title="No OP")):currHref=window.location.href,!currOPdiv){var a=document.getElementsByClassName("role-op")[0];a&&(currOPdiv=a.parentElement.parentElement.getElementsByClassName("username")[0],currOP=currOPdiv.text,currOPRef=currOPdiv.href,removeClass(searchDiv,"noOP"),searchDiv.className+=" haveOP",searchDiv.title="Scroll to OP")}},addButtons=function(){var a=$(".action.badge-action:not(.subscribable)");$.each(a,function(a,b){var c=subcribeBtn.cloneNode(!0);c.onclick=subcribeToUser,b.insertBefore(c,b.childNodes[0]),b.className+=" subscribable"});var b=document.getElementById("op");if(b&&opIsSetted&&currOP&&b.text!==currOP)b.text=currOP,b.href=currOPRef;else if(!opIsSetted&&currOP){if(!b){var c=$(".badge-entry-info.post-afterbar-meta>p");b=document.createElement("a"),c.append(b),b.id="op"}b.text=currOP,b.href=currOPRef,opIsSetted=!0}else if(!opIsSetted&&opId){if(!b){var c=$(".badge-entry-info.post-afterbar-meta>p");b=document.createElement("a"),c.append(b),b.id="op"}b.text=opId,c.append(b),opIsSetted=!0}},highliteOP=function(){setTimeout(function(){findOP(),addButtons(),$("span:has(span.role-op)").closest("div.payload").css("background-color","rgba(0, 178, 130, 0.06)"),highliteOP()},2e3)};window.location.href.indexOf("http://9gag.com/gag")!==-1&&(window.onload=function(){searchDiv=document.createElement("div"),searchDiv.id="findOP",searchDiv.onclick=scrollToOP,searchDiv.title="Can't find OP",searchDiv.className+=" noOP",document.body.insertBefore(searchDiv,document.body.childNodes[0]);var a=document.createElement("img");a.className="dickbutt",a.src="chrome-extension://"+extensionId+"/icons/dbutt.gif",searchDiv.appendChild(a);var b=document.createElement("img");b.className="travolta",b.src="chrome-extension://"+extensionId+"/icons/where.gif",searchDiv.appendChild(b);var c=document.createElement("div");c.id="searchTooltip",c.text="Load all comments!",searchDiv.appendChild(c),findOP(),highliteOP(),addButtons()});